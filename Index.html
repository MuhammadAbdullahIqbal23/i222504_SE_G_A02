<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Weather Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');

        body, html {
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
            height: 100%;
            background: linear-gradient(135deg, #000000, #4e310b);
            color: #333;
        }
        .container {
            display: flex;
            height: 100%;
        }
            .sidebar {
        border-top-right-radius: 15px;
        border-bottom-right-radius: 15px;
        width: 250px;
        background-color: rgba(255, 255, 255, 0.05); /* More translucent when not hovered */
        backdrop-filter: blur(10px);
        padding: 20px;
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }

    .sidebar:hover {
        background-color: rgba(255, 255, 255, 0.08); /* Brighter shade when hovered */
    }

        .logo {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            border-radius: 15%;
        }
        .logo img {
            width: 40px;
            margin-right: 10px;
            border-radius: 15%;

        }
        .logo-text {
            font-size: 18px;
            font-weight: bold;
            color: #fd9813;
            
        }
        .unit-toggle-container {
    display: flex;
    align-items: center;
    gap: 8px; /* Add some spacing between the label and dropdown */
}

#unitSelect {
    padding: 10px; /* Add padding for better appearance */
    border: none;
    border-radius: 5px;
background-color: #693c00;    color: white; /* Text color */
    cursor: pointer;
    transition: all 0.3s ease; /* Smooth transition */
}
#unitSelect_text{
    color: white;
    margin: 10px;
}
#unitSelect:hover {
background-color: #bb6a00;
}

        .sidebar-divider {
            height: 1px;
            background-color: rgba(255, 255, 255, 0.2);
            margin: 10px 0;
        }
        .sidebar-button {
            display: block;
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            background-color: #693c00;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            color: #fff;
            transition: all 0.3s ease;
        }
        .sidebar-button:hover {
            background-color: #bb6a00;

            transform: translateY(-2px);
        }
        .main-content {
            flex-grow: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        .search-container {
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
        }
        .search-container input {
            padding: 10px;
            width: 300px;
            border: none;
            border-radius: 25px 0 0 25px;
            font-size: 16px;
        }
        .search-container button {
            padding: 10px 20px;
            background-color: #693c00;
            color: white;
            border: none;
            border-radius: 0 25px 25px 0;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        .search-container button:hover {
            background-color: #bb6a00;
        }
        #profile-picture {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
        }

        #profile-picture img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }
        .weather-widget {
            background-size: cover;
            background-position: center;
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
        }
        .weather-widget:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
        }
        .charts-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .chart-wrapper {
            width: 30%;
            height: 300px;
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
        }
        .chart-wrapper:hover {
            transform: scale(1.03);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.7);
        }

        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        @keyframes floating {
            0% { transform: translate(0,  0px); }
            50%  { transform: translate(0, 15px); }
            100%   { transform: translate(0, -0px); }   
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="logo">
                <img src="logo.jpeg" alt="Weather App Logo" >
                <span class="logo-text">Weather App</span>
            </div>
            <div class="sidebar-divider"></div>
            <button class="sidebar-button" onclick="window.location.href='index.html'">Dashboard</button>
            <button class="sidebar-button" onclick="window.location.href='table.html'">Tables</button>
        </div>
        <div class="main-content">
            <div class="search-container">
                <input type="text" id="cityInput" placeholder="Enter city name">
                <button onclick="getWeather()">Get Weather</button>
                <div class="unit-toggle-container">
                    <label id="unitSelect_text">Select Unit:</label>
                    <select id="unitSelect" onchange="toggleUnits()">
                        <option value="metric" selected>Celsius (°C)</option>
                        <option value="imperial">Fahrenheit (°F)</option>
                    </select>
                </div>
                                
                <img src="profile-picture.png" alt="" id="profile-picture">
            </div>
            
            <div id="weatherWidget" class="weather-widget floating"></div>
            <div class="charts-container">
                <div class="chart-wrapper">
                    <canvas id="temperatureBarChart" width="400" height="200"></canvas>
                </div>
                <div class="chart-wrapper">
                    <canvas id="conditionsChart"></canvas>
                </div>
                <div class="chart-wrapper">
                    <canvas id="temperatureLineChart" width="400" height="200"></canvas>
                </div>
            </div>
            
        </div>
    </div>

    <script>
        const API_KEY = '031bb10685bdb53d0b947e5eb8bc5c5e';
        let forecastData = [];
        let currentPage = 1;
        let barChart, doughnutChart, lineChart;
    
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition, showError);
            } else {
                alert('Geolocation is not supported by this browser.');
            }
        }
    
        function showPosition(position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            fetchWeatherAndForecastByCoords(lat, lon);
        }
    
        function showError(error) {
            switch (error.code) {
                case error.PERMISSION_DENIED:
                    alert("User denied the request for Geolocation.");
                    break;
                case error.POSITION_UNAVAILABLE:
                    alert("Location information is unavailable.");
                    break;
                case error.TIMEOUT:
                    alert("The request to get user location timed out.");
                    break;
                case error.UNKNOWN_ERROR:
                    alert("An unknown error occurred.");
                    break;
            }
        }
    
        let currentUnit = 'metric'; // Default to Celsius (metric system)
        let isCelsius = true; // Toggle state

        // Function to toggle between Celsius and Fahrenheit
        function toggleUnits() {
            isCelsius = !isCelsius;
            document.getElementById('unitLabel').textContent = isCelsius ? 'Celsius' : 'Fahrenheit';
            getWeather(); // Re-fetch weather data in the new unit system
        }

        // Function to convert temperature based on selected unit
        function convertTemperature(temp) {
            if (isCelsius) {
                return temp; // Celsius, no conversion needed
            } else {
                return (temp * 9/5) + 32; // Convert to Fahrenheit
            }
        }

        function getWeather() {
            const city = document.getElementById('cityInput').value;
            currentUnit = isCelsius ? 'metric' : 'imperial'; // Update unit system based on toggle
            const currentWeatherUrl = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${API_KEY}&units=${currentUnit}`;
            const forecastUrl = `https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${API_KEY}&units=${currentUnit}`;

            $.getJSON(currentWeatherUrl, function(data) {
                updateWeatherWidget(data);
            }).fail(function() {
                alert('Error: City not found or API limit reached.');
            });

            $.getJSON(forecastUrl, function(data) {
                forecastData = data.list;
                destroyCharts();  // Destroy the existing charts before updating
                updateCharts();   // Update charts with new data
            }).fail(function() {
                alert('Error: Unable to fetch forecast data.');
            });
        }

        function updateWeatherWidget(data) {
            const widget = document.getElementById('weatherWidget');
            const weatherCondition = data.weather[0].main.toLowerCase();
            widget.style.backgroundImage = `url('/api/placeholder/800/400?text=${weatherCondition}')`;

            const temp = convertTemperature(data.main.temp); // Convert based on the unit
            const tempUnit = isCelsius ? '°C' : '°F'; // Display the unit dynamically

            widget.innerHTML = `
                <h2>${data.name}</h2>
                <p>Temperature: ${temp}${tempUnit}</p>
                <p>Humidity: ${data.main.humidity}%</p>
                <p>Wind Speed: ${data.wind.speed} m/s</p>
                <p>Weather: ${data.weather[0].description}</p>
            `;

            anime({
                targets: widget,
                opacity: [0, 1],
                translateY: [50, 0],
                duration: 1000,
                easing: 'easeOutElastic(1, .8)'
            });
        }
    
        function fetchWeatherAndForecastByCoords(lat, lon) {
            const currentWeatherUrl = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric`;
            const forecastUrl = `https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric`;
    
            $.getJSON(currentWeatherUrl, function(data) {
                document.getElementById('cityInput').value = data.name;
                updateWeatherWidget(data);
            }).fail(function() {
                alert('Error: Unable to fetch weather data for current location.');
            });
    
            $.getJSON(forecastUrl, function(data) {
                forecastData = data.list;
                destroyCharts();  // Destroy the existing charts before updating
                updateCharts();   // Update charts with new data
                updateForecastTable();
            }).fail(function() {
                alert('Error: Unable to fetch forecast data.');
            });
        }
    
        function updateWeatherWidget(data) {
            const widget = document.getElementById('weatherWidget');
            const weatherCondition = data.weather[0].main.toLowerCase();
            widget.style.backgroundImage = `url('/api/placeholder/800/400?text=${weatherCondition}')`;
            widget.innerHTML = `
                <h2>${data.name}</h2>
                <p>Temperature: ${data.main.temp}°C</p>
                <p>Humidity: ${data.main.humidity}%</p>
                <p>Wind Speed: ${data.wind.speed} m/s</p>
                <p>Weather: ${data.weather[0].description}</p>
            `;
            anime({
                targets: widget,
                opacity: [0, 1],
                translateY: [50, 0],
                duration: 1000,
                easing: 'easeOutElastic(1, .8)'
            });
        }
    
        function updateCharts() {
            updateTemperatureBarChart();
            updateConditionsDoughnutChart();
            updateTemperatureLineChart();
        }
        function toggleUnits() {
            const unitSelect = document.getElementById('unitSelect');
            currentUnit = unitSelect.value; // Get the selected unit from the dropdown
            isCelsius = currentUnit === 'metric'; // Update isCelsius based on the selected unit
            document.getElementById('unitLabel').textContent = isCelsius ? 'Celsius' : 'Fahrenheit';
            getWeather(); // Re-fetch weather data in the new unit system
        }

    
        function destroyCharts() {
            if (barChart) barChart.destroy();
            if (doughnutChart) doughnutChart.destroy();
            if (lineChart) lineChart.destroy();
        }
    
        function updateTemperatureBarChart() {
        const ctx = document.getElementById('temperatureBarChart').getContext('2d');
        const temperatures = forecastData.slice(0, 5).map(item => convertTemperature(item.main.temp));
        const labels = forecastData.slice(0, 5).map(item => new Date(item.dt * 1000).toLocaleDateString());
        
        const tempUnit = isCelsius ? '°C' : '°F'; // Update chart label unit

        barChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: `Temperature (${tempUnit})`,
                    data: temperatures,
                    backgroundColor: 'rgba(75, 192, 192, 0.5)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: { color: 'white' }
                    },
                    title: {
                        display: true,
                        text: `5 Days Temperature Bar Chart (${tempUnit})`,
                        color: 'white',
                        font: { size: 18 }
                    }
                },
                scales: {
                    y: { ticks: { color: 'white' } },
                    x: { ticks: { color: 'white' } }
                }
            }
        });
    }

    
    function updateConditionsDoughnutChart() {
    const ctx = document.getElementById('conditionsChart').getContext('2d');
    // Get data for 5 days (assuming 8 data points per day)
    const fiveDaysData = forecastData.slice(0, 40);
    // Group the data by day
    const groupedByDay = fiveDaysData.reduce((acc, item, index) => {
        const dayIndex = Math.floor(index / 8);
        if (!acc[dayIndex]) {
            acc[dayIndex] = [];
        }
        acc[dayIndex].push(item);
        return acc;
    }, {});

    // Get the most common condition for each day
    const dailyConditions = Object.values(groupedByDay).map(day => {
        const conditions = day.map(item => item.weather[0].main);
        return conditions.reduce((a, b, i, arr) =>
            arr.filter(v => v === a).length >= arr.filter(v => v === b).length ? a : b
        );
    });

    const conditionCounts = dailyConditions.reduce((acc, condition) => {
        acc[condition] = (acc[condition] || 0) + 1;
        return acc;
    }, {});

    // Define a color map for different weather conditions
    const weatherColors = {
        'Clear': 'rgba(255, 223, 0, 0.8)',      // Bright yellow
        'Clouds': 'rgba(169, 169, 169, 0.8)',   // Light gray
        'Rain': 'rgba(0, 0, 255, 0.8)',         // Blue
        'Drizzle': 'rgba(138, 43, 226, 0.8)',   // Blue violet
        'Thunderstorm': 'rgba(255, 0, 0, 0.8)', // Red
        'Snow': 'rgba(255, 250, 250, 0.8)',     // Snow white
        'Mist': 'rgba(216, 191, 216, 0.8)',     // Thistle
        'Fog': 'rgba(192, 192, 192, 0.8)',      // Silver
        'Haze': 'rgba(210, 180, 140, 0.8)',     // Tan
        'Dust': 'rgba(210, 105, 30, 0.8)',      // Chocolate
        'Smoke': 'rgba(112, 128, 144, 0.8)',    // Slate gray
        'Tornado': 'rgba(128, 0, 128, 0.8)',    // Purple
        'Squall': 'rgba(0, 128, 128, 0.8)'      // Teal
    };

    // Default color for any undefined weather condition
    const defaultColor = 'rgba(128, 128, 128, 0.8)'; // Gray

    doughnutChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: Object.keys(conditionCounts),
            datasets: [{
                data: Object.values(conditionCounts),
                backgroundColor: Object.keys(conditionCounts).map(condition => weatherColors[condition] || defaultColor)
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: {
                delay: (context) => context.dataIndex * 300
            },
            plugins: {
                legend: {
                    labels: { color: 'white' }
                },
                title: {
                    display: true,
                    text: '5 Days Weather Condition',
                    color: 'white',
                    font: { size: 18 }
                }
            }
        }
    });
}
    
        function updateTemperatureLineChart() {
            const ctx = document.getElementById('temperatureLineChart').getContext('2d');
            const temperatures = forecastData.slice(0, 5).map(item => item.main.temp);
            const labels = forecastData.slice(0, 5).map(item => new Date(item.dt * 1000).toLocaleDateString());
    
            lineChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Temperature (°C)',
                        data: temperatures,
                        borderColor: 'rgba(255, 159, 64, 1)',
                        backgroundColor: 'rgba(255, 159, 64, 0.2)',
                        borderWidth: 2,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: { color: 'white' }
                        },
                        title: {
                            display: true,
                            text: '5 Days Temperature Line Chart',
                            color: 'white',
                            font: { size: 18 }
                        }
                    },
                    scales: {
                        y: { ticks: { color: 'white' } },
                        x: { ticks: { color: 'white' } }
                    }
                }
            });
        }
    
        function updateForecastTable() {
            const forecastTableContainer = document.getElementById('forecastTableContainer');
            const tableHTML = `
                <table class="forecast-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Temperature</th>
                            <th>Condition</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${forecastData.slice((currentPage - 1) * itemsPerPage, currentPage * itemsPerPage).map(item => `
                            <tr>
                                <td>${new Date(item.dt * 1000).toLocaleString()}</td>
                                <td>${item.main.temp}°C</td>
                                <td>${item.weather[0].description}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            forecastTableContainer.innerHTML = tableHTML;
        }
        function updateWeatherWidget(data) {
        const widget = document.getElementById('weatherWidget');
        const weatherCondition = data.weather[0].main.toLowerCase();
        const body = document.body;

        // Default background (for "clear" weather)
        let gradient = "linear-gradient(135deg, #000000, #4e310b)";

        // Change background based on weather conditions
        if (weatherCondition.includes('clouds')) {
            gradient = "linear-gradient(135deg, #c0c0c0, #808080)"; // Silverish for clouds
        } else if (weatherCondition.includes('rain')) {
            gradient = "linear-gradient(135deg, #3b5998, #0e4d92)"; // Blueish for rain
        } else if (weatherCondition.includes('thunderstorm')) {
            gradient = "linear-gradient(135deg, #ff0000, #8b0000)"; // Red for thunderstorm
        } else if (weatherCondition.includes('clear')) {
            gradient = "linear-gradient(135deg, #000000, #4e310b)"; // Original gradient for sunny
        }

        // Apply the gradient to the body background
        body.style.background = gradient;

        const temp = convertTemperature(data.main.temp);
        const tempUnit = isCelsius ? '°C' : '°F';

        widget.innerHTML = `
            <h2>${data.name}</h2>
            <p>Temperature: ${temp}${tempUnit}</p>
            <p>Humidity: ${data.main.humidity}%</p>
            <p>Wind Speed: ${data.wind.speed} m/s</p>
            <p>Weather: ${data.weather[0].description}</p>
        `;

        anime({
            targets: widget,
            opacity: [0, 1],
            translateY: [50, 0],
            duration: 1000,
            easing: 'easeOutElastic(1, .8)'
        });
    }
        window.onload = function() {
            getLocation();
        }
    </script>
    
</body>
</html>
